<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:SlippiTV.Client.ViewModels"
             xmlns:mi="http://www.aathifmahir.com/dotnet/2022/maui/icons"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:local="clr-namespace:SlippiTV.Client"
             x:Class="SlippiTV.Client.SettingsPage"
             Title="Settings"
             x:DataType="{x:Type vm:SettingsViewModel}">
    <ContentPage.Resources>
        <ResourceDictionary>
            <Style TargetType="Span">
                <Setter Property="FontSize" Value="12"/>
            </Style>
            <Style TargetType="Button">
                <Setter Property="FontSize" Value="16"/>
                <Setter Property="HeightRequest" Value="36"/>
            </Style>
            <Style TargetType="Border">
                <Setter Property="BackgroundColor" Value="{AppThemeBinding Light=#FaFaFa, Dark=#333333}"/>
                <Setter Property="StrokeShape" Value="RoundRectangle 8"/>
            </Style>
            <Style TargetType="HorizontalStackLayout">
                <Setter Property="HeightRequest" Value="36"/>
                <Setter Property="Spacing" Value="12"/>
            </Style>
            <toolkit:IsStringNotNullOrEmptyConverter x:Key="StringToVisibilityConverter"/>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <VerticalStackLayout Spacing="24" Padding="10" Grid.Row="0">
            <VerticalStackLayout Spacing="6">
                <Label VerticalTextAlignment="Center" LineBreakMode="TailTruncation">
                    <Label.FormattedText>
                        <FormattedString>
                            <Span Text="{Binding MeleeISOPathLabelText}" FontAttributes="Bold" FontSize="20"/>
                        </FormattedString>
                    </Label.FormattedText>
                </Label>
                <HorizontalStackLayout>
                    <Border>
                        <Label VerticalTextAlignment="Center" LineBreakMode="TailTruncation" Padding="18,0,18,0" WidthRequest="360">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="{Binding Settings.WatchMeleeISOPath}" />
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                    </Border>
                    <Button x:Name="MeleeIsoBrowseButton" 
                            Text="Browse"
                            Clicked="MeleeIsoBrowseButton_Clicked" 
                            VerticalOptions="Center"
                            Padding="16,4,16,8"/>
                </HorizontalStackLayout>
            </VerticalStackLayout>

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Label VerticalTextAlignment="Center" LineBreakMode="WordWrap" Grid.Column="0" Grid.Row="0">
                    <Label.FormattedText>
                        <FormattedString>
                            <Span Text="{Binding WatchDolphinPathLabelText}" FontSize="20" FontAttributes="Bold"/>
                        </FormattedString>
                    </Label.FormattedText>
                </Label>
                <HorizontalStackLayout Grid.Column="2" Grid.Row="1">
                    <Border>
                        <Label VerticalTextAlignment="Center" LineBreakMode="TailTruncation"  Padding="18,0,18,0" WidthRequest="360">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="{Binding Settings.WatchDolphinPath}"/>
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                    </Border>
                    <Button x:Name="WatchDolphinBrowseButton" 
                            IsVisible="{Binding Settings.ShowWatchDolphinEdit}"
                            Text="Browse"
                            Clicked="WatchDolphinBrowseButton_Clicked"
                            VerticalOptions="Center"
                            Padding="16,4,16,8"/>
                </HorizontalStackLayout>
            </Grid>

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <BoxView HeightRequest="1" Color="#333333" Margin="0,0,0,6" Grid.Row="0"/>
                <VerticalStackLayout Grid.Row="1">
                    <Label VerticalTextAlignment="Center" LineBreakMode="CharacterWrap">
                        <Label.FormattedText>
                            <FormattedString>
                                <Span Text="Your Connection Info: " FontAttributes="Bold" FontSize="20"/>
                            </FormattedString>
                        </Label.FormattedText>
                    </Label>
                    <Label VerticalTextAlignment="Center" LineBreakMode="CharacterWrap" Margin="4,-4,0,0">
                        <Label.FormattedText>
                            <FormattedString>
                                <Span Text="Fills Automatically From Local Files" FontSize="12" TextColor="{AppThemeBinding Light=#50000000, Dark=#50FFFFFF}"/>
                            </FormattedString>
                        </Label.FormattedText>
                    </Label>
                </VerticalStackLayout>

                <HorizontalStackLayout Spacing="5" HorizontalOptions="End" Grid.Row="1">
                    <Border>
                        <Label VerticalTextAlignment="Center" LineBreakMode="CharacterWrap" Padding="18,0,18,0">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="{Binding Settings.StreamMeleeConnectCode}"/>
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                    </Border>
                    <Border IsVisible="{Binding Settings.StreamMeleeDisplayName, Converter={StaticResource StringToVisibilityConverter}}">
                        <Label VerticalTextAlignment="Center" LineBreakMode="CharacterWrap" Padding="18,0,18,0">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="{Binding Settings.StreamMeleeDisplayName}"/>
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                    </Border>
                    <ImageButton x:Name="EditConnectCodeButton" 
                                 IsVisible="{Binding Settings.ShowConnectCodeEdit}"
                                 Clicked="EditConnectCodeButton_Clicked" 
                                 BackgroundColor="Transparent" 
                                 Aspect="AspectFit" 
                                 HeightRequest="2" 
                                 WidthRequest="2">
                        <ImageButton.Source>
                            <FontImageSource Glyph="{mi:FluentFilled Icon=Edit24Filled, IconColor={AppThemeBinding Light=#AAAAAA, Dark=#CCCCCC}}"/>
                        </ImageButton.Source>
                    </ImageButton>
                </HorizontalStackLayout>
            </Grid>
        </VerticalStackLayout>

        <local:BottomBar Grid.Row="2" BindingContext="{Binding ShellViewModel}" HeightRequest="20"/>
    </Grid>
</ContentPage>